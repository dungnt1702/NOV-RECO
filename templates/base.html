{% load static %}
<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="NOV-RECO">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NOV-RECO">
    <meta name="description" content="Hệ thống check-in và quản lý nhân sự NOV-RECO">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-config" content="/static/browserconfig.xml">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#667eea">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="{% static 'logo-192.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'logo-144.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'logo-192.png' %}">
    <link rel="apple-touch-icon" sizes="167x167" href="{% static 'logo-144.png' %}">
    
    <!-- Standard Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'logo-48.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'logo-48.png' %}">
    <link rel="shortcut icon" href="{% static 'favicon.png' %}">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
    
    <title>{% block title %}NOV-RECO Check-in System{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/vendor/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/vendor/inter-fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/vendor/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="page-wrapper">
    <!-- Header -->
    {% include 'header.html' %}

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'footer.html' %}

    </div>

    <!-- Scripts -->
    <script src="{% static 'js/vendor/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/icons.js' %}"></script>
    <script src="{% static 'js/base.js' %}"></script>
    <script src="{% static 'js/notifications.js' %}"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('{% static "sw.js" %}')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content is available, show update notification
                                    if (confirm('Phiên bản mới đã có sẵn. Bạn có muốn cập nhật không?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('PWA install prompt triggered');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show custom install button if needed
            showInstallButton();
        });
        
        // PWA Installed
        window.addEventListener('appinstalled', function(e) {
            console.log('PWA was installed');
            hideInstallButton();
        });
        
        function showInstallButton() {
            // You can add a custom install button here
            console.log('Show install button');
        }
        
        function hideInstallButton() {
            // Hide install button after installation
            console.log('Hide install button');
        }
        
        // Handle PWA install
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(function(choiceResult) {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the PWA install prompt');
                    } else {
                        console.log('User dismissed the PWA install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
