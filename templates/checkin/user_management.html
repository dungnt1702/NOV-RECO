{% extends 'base.html' %}
{% load static %}

{% block title %}Quản lý người dùng - NOV-RECO{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
  <div class="dashboard-container">
    <div class="dashboard-header">
      <h1>Quản lý người dùng</h1>
      <p class="dashboard-subtitle">Quản lý tài khoản và quyền hạn</p>
    </div>

    <div class="dashboard-content">
      <!-- User Management Content -->
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Họ tên</th>
              <th>Email</th>
              <th>Vai trò</th>
              <th>Phòng ban</th>
              <th>Trạng thái</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody id="users-table">
            <!-- Users will be loaded here via JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button onclick="loadUsers()" class="action-button">
          <i class="fas fa-refresh"></i>
          Tải lại
        </button>
        <button onclick="createUser()" class="action-button success">
          <i class="fas fa-plus"></i>
          Thêm người dùng
        </button>
        <a href="/checkin/admin-dashboard/" class="action-button secondary">
          <i class="fas fa-arrow-left"></i>
          Quay lại
        </a>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/base.js' %}"></script>
  <script>
    // User management JavaScript
    async function loadUsers() {
      try {
        const response = await api('/checkin/users-api/');
        if (response.ok) {
          const users = await response.json();
          renderUsersTable(users);
        }
      } catch (error) {
        console.error('Error loading users:', error);
        showAlert('Lỗi tải danh sách người dùng', 'error');
      }
    }

    function renderUsersTable(users) {
      const tbody = document.getElementById('users-table');
      tbody.innerHTML = users.map(user => `
        <tr>
          <td>${user.id}</td>
          <td>${user.display_name}</td>
          <td>${user.email}</td>
          <td>${user.role_display || user.role}</td>
          <td>${user.department || 'N/A'}</td>
          <td>
            <span class="badge ${user.is_active ? 'success' : 'danger'}">
              ${user.is_active ? 'Hoạt động' : 'Không hoạt động'}
            </span>
          </td>
          <td>
            <button onclick="editUser(${user.id})" class="btn btn-sm">Sửa</button>
            <button onclick="deleteUser(${user.id})" class="btn btn-sm danger">Xóa</button>
          </td>
        </tr>
      `).join('');
    }

    function createUser() {
      // Implementation for creating new user
      showAlert('Tính năng đang phát triển', 'info');
    }

    function editUser(userId) {
      // Implementation for editing user
      showAlert('Tính năng đang phát triển', 'info');
    }

    function deleteUser(userId) {
      if (confirm('Bạn có chắc chắn muốn xóa người dùng này?')) {
        // Implementation for deleting user
        showAlert('Tính năng đang phát triển', 'info');
      }
    }

    // Load users on page load
    document.addEventListener('DOMContentLoaded', loadUsers);
  </script>
{% endblock %}
