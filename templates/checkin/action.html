{% extends 'base.html' %}
{% load static %}

{% block title %}Check-in - NOV-RECO{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="{% static 'css/checkin/action.css' %}">
{% endblock %}

{% block content %}
<div class="checkin-page">
    <div class="checkin-container">
        <div class="checkin-header">
            <h1 class="checkin-title">
                <i class="fas fa-camera"></i> Check-in
            </h1>
            <p class="checkin-subtitle">
                Ch·ª•p ·∫£nh v√† x√°c ƒë·ªãnh v·ªã tr√≠ ƒë·ªÉ check-in
            </p>
        </div>

        <div class="checkin-content">
            <!-- Main Check-in Form -->
            <div id="checkinForm" class="checkin-form">
                <form id="checkinFormElement">
                    {% csrf_token %}
                    
                    <!-- Camera Section -->
                    <div class="camera-section">
                        <div class="section-header">
                            <h3><i class="fas fa-camera"></i> Ch·ª•p ·∫£nh</h3>
                            <p class="section-subtitle">Ch·ª•p ·∫£nh ƒë·ªÉ x√°c minh danh t√≠nh</p>
                        </div>
                        <div class="camera-container">
                            <div id="camera-preview" class="camera-preview">
                                <div class="camera-placeholder">
                                    <div class="camera-icon">üì∑</div>
                                    <div class="camera-text">Ch·∫°m ƒë·ªÉ m·ªü camera</div>
                                    <div class="camera-hint">Camera s·∫Ω t·ª± ƒë·ªông l·∫•y v·ªã tr√≠</div>
                                </div>
                            </div>
                            <video id="video" autoplay muted style="display: none;"></video>
                            <canvas id="canvas" style="display: none;"></canvas>
                            
                            <!-- Camera Controls -->
                            <div class="camera-controls">
                                <button type="button" id="captureBtn" class="btn-capture">
                                    <i class="fas fa-camera"></i>
                                    <span>Ch·ª•p ·∫£nh</span>
                                </button>
                                <button type="button" id="switchCameraBtn" class="btn-switch">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>ƒê·ªïi camera</span>
                                </button>
                            </div>
                            
                            <!-- Photo Preview -->
                            <div id="photoPreview" class="photo-preview" style="display: none;">
                                <div class="photo-container">
                                    <img id="previewImg" alt="Preview">
                                    <div class="photo-overlay">
                                        <button type="button" id="retakeBtn" class="btn-retake">
                                            <i class="fas fa-redo"></i>
                                            <span>Ch·ª•p l·∫°i</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Location Section -->
                    <div class="location-section">
                        <div class="section-header">
                            <h3><i class="fas fa-map-marker-alt"></i> V·ªã tr√≠</h3>
                            <p class="section-subtitle">X√°c ƒë·ªãnh v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫°n</p>
                        </div>
                        
                        <!-- Location Status -->
                        <div class="location-status-container">
                            <div id="locationStatus" class="location-status" style="display: none;">
                                <div class="status-icon">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                                <div class="status-text">
                                    <span class="status-title">ƒêang l·∫•y v·ªã tr√≠...</span>
                                    <span class="status-subtitle">Vui l√≤ng cho ph√©p truy c·∫≠p v·ªã tr√≠</span>
                                </div>
                            </div>
                            
                            <!-- Location Button -->
                            <button type="button" id="getLocationBtn" class="btn-location">
                                <i class="fas fa-location-arrow"></i>
                                <span>L·∫•y v·ªã tr√≠</span>
                            </button>
                        </div>
                        
                        <!-- Location Details -->
                        <div id="locationDetails" class="location-details" style="display: none;">
                            <div class="location-info-card">
                                <div class="info-item">
                                    <i class="fas fa-globe"></i>
                                    <div class="info-content">
                                        <span class="info-label">Vƒ© ƒë·ªô</span>
                                        <span class="info-value" id="currentLat">-</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-globe"></i>
                                    <div class="info-content">
                                        <span class="info-label">Kinh ƒë·ªô</span>
                                        <span class="info-value" id="currentLng">-</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-crosshairs"></i>
                                    <div class="info-content">
                                        <span class="info-label">ƒê·ªô ch√≠nh x√°c</span>
                                        <span class="info-value" id="locationAccuracy">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Map for location selection -->
                        <div id="map" class="map-container"></div>
                    </div>

                    <!-- Note Section -->
                    <div class="note-section">
                        <div class="section-header">
                            <h3><i class="fas fa-sticky-note"></i> Ghi ch√∫</h3>
                            <p class="section-subtitle">Th√™m ghi ch√∫ cho l·∫ßn check-in n√†y (t√πy ch·ªçn)</p>
                        </div>
                        <div class="note-container">
                            <textarea id="note" name="note" class="note-textarea" rows="3" placeholder="Nh·∫≠p ghi ch√∫ v·ªÅ l·∫ßn check-in n√†y..."></textarea>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="submit-section">
                        <button type="submit" id="submitBtn" class="btn-submit" disabled>
                            <div class="btn-content">
                                <i class="fas fa-check"></i>
                                <span>Ho√†n th√†nh Check-in</span>
                            </div>
                            <div class="btn-loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>ƒêang x·ª≠ l√Ω...</span>
                            </div>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{% static 'js/checkin/action.js' %}"></script>
{% endblock %}
