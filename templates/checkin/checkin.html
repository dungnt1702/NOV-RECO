{% extends 'base.html' %}
{% load static %}

{% block title %}NOV-RECO Check-in System{% endblock %}

{% block extra_css %}
  <!-- OpenStreetMap - Miá»…n phÃ­, khÃ´ng cáº§n API key -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="{% static 'css/checkin.css' %}">
{% endblock %}

{% block content %}
  <div class="checkin-page">
    <div class="checkin-container">
      <div class="checkin-header">
        <div style="margin-bottom: 15px;">
          <img src="{% static 'logo.svg' %}" alt="NOV-RECO Logo" style="height: 50px;">
    </div>
        <h1>ğŸ“ Check-in System</h1>
        <p class="checkin-subtitle">Chá»¥p áº£nh trá»±c tiáº¿p vÃ  láº¥y vá»‹ trÃ­ GPS Ä‘á»ƒ check-in</p>
      </div>

      <!-- Browser Permissions Check -->
      <div class="permissions-check-section">
        <div class="permissions-title">ğŸ” Kiá»ƒm tra quyá»n truy cáº­p</div>
        <div class="permissions-grid">
          <div class="permission-item">
            <span class="permission-label">ğŸ“ GPS/Vá»‹ trÃ­:</span>
            <span class="permission-status" id="gps-status">ChÆ°a kiá»ƒm tra</span>
            <button type="button" id="btn-test-gps" class="btn-test-permission">Test GPS</button>
          </div>
          <div class="permission-item">
            <span class="permission-label">ğŸ“· Camera:</span>
            <span class="permission-status" id="camera-status">ChÆ°a kiá»ƒm tra</span>
            <button type="button" id="btn-test-camera" class="btn-test-permission">Test Camera</button>
          </div>
        </div>
        <div class="permissions-help">
          <p><strong>ğŸ’¡ Máº¹o:</strong> Náº¿u khÃ´ng tháº¥y popup yÃªu cáº§u quyá»n, hÃ£y nháº¥p vÃ o biá»ƒu tÆ°á»£ng ğŸ”’ bÃªn trÃ¡i thanh Ä‘á»‹a chá»‰ Ä‘á»ƒ cáº¥p quyá»n thá»§ cÃ´ng.</p>
        </div>
      </div>

      <!-- User Info Section -->
      <div class="user-info-section">
        <div class="user-info-title">ğŸ‘¤ ThÃ´ng tin ngÆ°á»i dÃ¹ng</div>
        <div class="user-info-grid">
          <div class="user-info-item">
            <div class="user-info-label">Há» tÃªn</div>
            <div class="user-info-value" id="user-name">Äang táº£i...</div>
          </div>
          <div class="user-info-item">
            <div class="user-info-label">Email</div>
            <div class="user-info-value" id="user-email">Äang táº£i...</div>
          </div>
          <div class="user-info-item">
            <div class="user-info-label">PhÃ²ng ban</div>
            <div class="user-info-value" id="user-department">Äang táº£i...</div>
          </div>
          <div class="user-info-item">
            <div class="user-info-label">Vai trÃ²</div>
            <div class="user-info-value" id="user-role">Äang táº£i...</div>
          </div>
        </div>
      </div>

      <form id="checkin-form" class="checkin-form">
        {% csrf_token %}
        
        <!-- Map Section -->
        <div class="form-group">
          <div class="map-container">
            <div class="map-controls">
              <span class="map-label">ğŸ—ºï¸ Vá»‹ trÃ­ hiá»‡n táº¡i</span>
              <button type="button" id="btn-get-location" class="btn-get-location">
                ğŸ“ Láº¥y tá»a Ä‘á»™
              </button>
            </div>
            <div id="map"></div>
            <div class="coordinates" id="coordinates">ChÆ°a láº¥y vá»‹ trÃ­</div>
          </div>
        </div>

        <!-- Camera Section -->
        <div class="form-group">
          <label class="form-label">ğŸ“· áº¢nh check-in</label>
          <div class="camera-container">
            <div id="camera-preview" class="camera-preview">
              <div class="camera-icon">ğŸ“·</div>
              <div class="camera-text">Cháº¡m Ä‘á»ƒ chá»¥p áº£nh</div>
            </div>
            <div class="camera-controls">
              <button type="button" id="btn-capture" class="btn-camera">
                ğŸ“· Chá»¥p áº£nh
              </button>
              <button type="button" id="btn-retake" class="btn-camera danger" style="display: none;">
                ğŸ”„ Chá»¥p láº¡i
              </button>
              <button type="button" id="btn-switch-camera" class="btn-camera secondary" style="display: none;" title="Chuyá»ƒn Ä‘á»•i camera trÆ°á»›c/sau">
                ğŸ”„ Äá»•i camera
              </button>
            </div>
          </div>
          <input type="file" id="photo" accept="image/*" capture="environment" style="display: none;">
      </div>

      <div class="form-group">
          <label class="form-label" for="note">ğŸ“ Ghi chÃº (tÃ¹y chá»n)</label>
        <textarea id="note" class="form-textarea" placeholder="VÃ­ dá»¥: Team A, ca 9h..."></textarea>
      </div>

      <button type="submit" id="btn-checkin" class="btn-checkin">
          <span class="btn-text">âœ… Gá»­i Check-in</span>
        <div class="loading">
          <div class="spinner"></div>
          <span>Äang xá»­ lÃ½...</span>
        </div>
      </button>
    </form>
  </div>
  </div>

{% endblock %}

{% block extra_js %}
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="{% static 'js/checkin.js' %}"></script>
{% endblock %}