{% extends 'base.html' %}
{% load static %}
{% load user_permissions %}

{% block title %}Qu·∫£n l√Ω ng∆∞·ªùi d√πng{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/users.css' %}">
<link rel="stylesheet" href="{% static 'css/users/user_filter.css' %}">
{% endblock %}

{% block content %}
<div class="users-page">
  <div class="page-header">
    <h1>üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
    <a href="{% url 'users:create' %}" class="btn btn-primary">
      ‚ûï Th√™m ng∆∞·ªùi d√πng
    </a>
    {% if user|has_permission:'users.can_manage_users' %}
    <a href="{% url 'users:import' %}" class="btn btn-outline" style="margin-left:8px;">
      <i class="fas fa-file-import"></i> Import Excel
    </a>
    {% endif %}
  </div>

  <!-- Search and Filter -->
  <div class="search-filter-section collapsed" id="usersFilterSection">
    <div class="filter-header">
      <div class="filter-title">
        <i class="fas fa-filter"></i>
        <span>B·ªô l·ªçc</span>
      </div>
      <div class="filter-actions">
        <button type="button" class="btn btn-outline-secondary btn-sm" id="filterToggleBtn">
          Thu g·ªçn
        </button>
      </div>
    </div>
    <div class="search-form filter-body">
      <div class="search-input-group">
        <input type="text" placeholder="Nh·∫≠p t√™n ho·∫∑c email..." class="form-control search-input" id="nameSearch">
        <input type="text" placeholder="M√£ nh√¢n vi√™n" class="form-control" id="employeeIdSearch">
        <select class="form-control" id="officeSelect">
          <option value="">T·∫•t c·∫£ vƒÉn ph√≤ng</option>
          {% for office in offices %}
            <option value="{{ office.id }}">{{ office.name }}</option>
          {% endfor %}
        </select>
        <select class="form-control" id="departmentSelect">
          <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
          {% for dept in departments %}
            <option value="{{ dept.id }}">{{ dept.full_name }}</option>
          {% endfor %}
        </select>
        <select class="form-control role-select" id="roleSelect">
          <option value="">T·∫•t c·∫£ vai tr√≤</option>
          {% for value, label in role_choices %}
            <option value="{{ value }}">{{ label }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>

  <!-- Desktop Table View -->
  <div class="users-table-container desktop-view">
    <table class="users-table">
      <thead>
        <tr>
          <th>Th√¥ng tin</th>
          <th>Vai tr√≤</th>
          <th>Ph√≤ng ban</th>
          <th>M√£ NV</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <!-- Users will be loaded dynamically by JavaScript -->
      </tbody>
    </table>
  </div>

  <!-- Mobile Card View -->
  <div class="mobile-view">
    <!-- Users will be loaded dynamically by JavaScript -->
  </div>

  <!-- Pagination Component -->
  {% include 'components/pagination.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script>
  window.__USERS_PRESELECT__ = {
    officeId: '{{ current_office|default:'' }}',
    departmentId: '{{ current_dept|default:'' }}'
  };
</script>
<script src="{% static 'js/users.js' %}"></script>
{% endblock %}
