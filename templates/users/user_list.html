{% extends 'base.html' %}
{% load static %}

{% block title %}Qu·∫£n l√Ω ng∆∞·ªùi d√πng{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/users.css' %}">
{% endblock %}

{% block content %}
<div class="users-page">
  <div class="page-header">
    <h1>üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h1>
    <a href="{% url 'users:user_create' %}" class="btn btn-primary">
      ‚ûï Th√™m ng∆∞·ªùi d√πng
    </a>
  </div>

  <!-- Search and Filter -->
  <div class="search-filter-section">
    <form method="GET" class="search-form">
      <div class="search-input-group">
        <input type="text" name="search" value="{{ search_query }}" 
               placeholder="T√¨m ki·∫øm theo t√™n, email, m√£ nh√¢n vi√™n..." 
               class="form-control search-input">
        <select name="role" class="form-control role-select">
          <option value="">T·∫•t c·∫£ vai tr√≤</option>
          {% for value, label in role_choices %}
            <option value="{{ value }}" {% if role_filter == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
        <select name="department" class="form-control department-select">
          <option value="">T·∫•t c·∫£ ph√≤ng ban</option>
          {% for dept in departments %}
            <option value="{{ dept.id }}" {% if department_filter == dept.id|stringformat:"s" %}selected{% endif %}>
              {{ dept.name }}
            </option>
          {% endfor %}
        </select>
        <button type="submit" class="btn btn-search">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          T√¨m ki·∫øm
        </button>
      </div>
    </form>
  </div>

  <!-- Desktop Table View -->
  <div class="users-table-container desktop-view">
    <table class="users-table">
      <thead>
        <tr>
          <th>Th√¥ng tin</th>
          <th>Vai tr√≤</th>
          <th>Ph√≤ng ban</th>
          <th>M√£ NV</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        {% for user in page_obj %}
        <tr>
          <td class="user-info">
            <div class="user-avatar">
              {{ user.first_name|first|default:user.username|first|upper }}
            </div>
            <div class="user-details">
              <div class="user-name">{{ user.get_display_name }}</div>
              <div class="user-email">{{ user.email }}</div>
            </div>
          </td>
          <td>
            <span class="role-badge role-{{ user.role }}">
              {{ user.get_role_display }}
            </span>
          </td>
          <td>
            {% if user.department %}
              <span class="department-name">{{ user.department.name }}</span>
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>{{ user.employee_id|default:"-" }}</td>
          <td>
            <span class="status-badge {% if user.is_active %}active{% else %}inactive{% endif %}">
              {% if user.is_active %}Ho·∫°t ƒë·ªông{% else %}Kh√¥ng ho·∫°t ƒë·ªông{% endif %}
            </span>
          </td>
          <td class="actions">
            <a href="{% url 'users:user_update' user.id %}" class="btn btn-sm btn-edit">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              S·ª≠a
            </a>
            <a href="{% url 'users:user_delete' user.id %}" class="btn btn-sm btn-danger">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
              X√≥a
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Mobile Card View -->
  <div class="mobile-view">
    {% for user in page_obj %}
    <div class="user-card">
      <div class="card-header">
        <div class="user-info">
          <div class="user-avatar">
            {{ user.first_name|first|default:user.username|first|upper }}
          </div>
          <div class="user-details">
            <h3 class="user-name">{{ user.get_display_name }}</h3>
            <p class="user-email">{{ user.email }}</p>
            {% if user.employee_id %}
              <p class="user-id">M√£ NV: {{ user.employee_id }}</p>
            {% endif %}
          </div>
        </div>
        <div class="user-status">
          <span class="status-badge {% if user.is_active %}active{% else %}inactive{% endif %}">
            {% if user.is_active %}Ho·∫°t ƒë·ªông{% else %}Kh√¥ng ho·∫°t ƒë·ªông{% endif %}
          </span>
        </div>
      </div>
      
      <div class="card-body">
        <div class="user-meta">
          <div class="meta-item">
            <span class="meta-label">Vai tr√≤:</span>
            <span class="role-badge role-{{ user.role }}">{{ user.get_role_display }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Ph√≤ng ban:</span>
            <span class="meta-value">
              {% if user.department %}
                {{ user.department.name }}
              {% else %}
                <span class="text-muted">Ch∆∞a ph√¢n c√¥ng</span>
              {% endif %}
            </span>
          </div>
        </div>
      </div>
      
      <div class="card-footer">
        <div class="card-actions">
          <a href="{% url 'users:user_update' user.id %}" class="btn btn-primary">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            S·ª≠a
          </a>
          <a href="{% url 'users:user_delete' user.id %}" class="btn btn-danger">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            X√≥a
          </a>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="empty-state">
      <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
      </svg>
      <h3>Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o</h3>
      <p>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc hi·ªán t·∫°i.</p>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination Component -->
  {% include 'components/pagination.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/users.js' %}"></script>
{% endblock %}
