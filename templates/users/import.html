{% extends 'base.html' %}
{% load static %}

{% block title %}Import người dùng - NOV-RECO{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/users/office_forms.css' %}">
{% endblock %}

{% block content %}
<div class="office-form-page">
  <div class="office-form-container">
    <div class="office-form-header">
      <h1>📥 Import người dùng từ CSV (UTF-8)</h1>
      <p>Tải lên file .csv (UTF-8, nên có BOM) với tiêu đề cột: username, first_name, last_name, email, role, employee_id, department_id</p>
    </div>

    {% if not has_openpyxl %}
      <div class="alert alert-warning" role="alert" style="margin-bottom: 16px;">
        Máy chủ chưa cài openpyxl, chỉ xem hướng dẫn. Vui lòng cài đặt để dùng import.
      </div>
    {% endif %}

    <div class="office-form-card">
      <form method="post" enctype="multipart/form-data" class="office-form">
        {% csrf_token %}
        <div class="office-form-group">
          <label class="office-form-label">Chọn file Excel (.xlsx)</label>
          <input type="file" name="file" accept=".csv" class="office-form-input" required>
        </div>
        <div class="office-form-group">
          <label class="office-form-label">Phòng ban mặc định (nếu file không có department_id)</label>
          <select name="default_department" class="office-form-select">
            <option value="">(Không chọn)</option>
            {% for dept in departments %}
              <option value="{{ dept.id }}">{{ dept.full_name }}</option>
            {% endfor %}
          </select>
          <div style="margin-top:8px;">
            <label style="display:flex;align-items:center;gap:8px;">
              <input type="checkbox" name="assign_default_department"> Tự động gán phòng ban mặc định nếu thiếu
            </label>
          </div>
        </div>

        <div class="office-form-actions" style="display:flex; gap:8px;">
          <button type="submit" class="office-form-btn">Import</button>
          <a href="{% url 'users:list' %}" class="office-form-btn" style="background:#64748b;">Quay lại</a>
          <a href="{% url 'users:import_template' %}" class="office-form-btn" style="background:#334155;">Tải mẫu CSV</a>
        </div>
      </form>
    </div>

    <div class="office-form-card" style="margin-top:16px;">
      <h3 style="margin-bottom:8px;">Hướng dẫn</h3>
      <div class="office-form-group">
        <ul style="color:#e2e8f0; line-height:1.8;">
          <li>Lưu file ở định dạng CSV, mã hóa UTF-8 (nên có BOM để Excel hiển thị tiếng Việt đúng).</li>
          <li>Dòng đầu tiên phải là tiêu đề cột theo đúng thứ tự: <code>username, first_name, last_name, email, role, employee_id, department_id</code>.</li>
          <li><code>role</code> chấp nhận: <code>super_admin</code>, <code>admin</code>, <code>manager</code>, <code>secretary</code>, <code>hr</code>, <code>employee</code>. Nếu trống sẽ mặc định <code>employee</code>.</li>
          <li><code>department_id</code> là ID phòng ban. Nếu để trống và bạn bật “Tự động gán phòng ban mặc định nếu thiếu”, hệ thống sẽ dùng phòng ban mặc định bạn chọn.</li>
          <li>Khuyến nghị: Tải mẫu CSV để điền cho đúng định dạng.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}


