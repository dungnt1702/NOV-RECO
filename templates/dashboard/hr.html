{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard Nhân sự - NOV-RECO{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard/hr.css' %}">
{% endblock %}

{% block content %}
<div class="hr-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="page-title">
                <i class="fas fa-users-cog"></i>
                Dashboard Nhân sự
            </h1>
            <p class="page-subtitle">Quản lý nhân viên và theo dõi hoạt động</p>
        </div>
        <div class="header-actions">
            <div class="quick-stats">
                <div class="quick-stat">
                    <span class="stat-number">{{ total_employees }}</span>
                    <span class="stat-label">Tổng nhân viên</span>
                </div>
                <div class="quick-stat">
                    <span class="stat-number">{{ employees_with_checkin_today }}</span>
                    <span class="stat-label">Check-in hôm nay</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-section">
        <div class="metrics-grid">
            <div class="metric-card primary">
                <div class="metric-header">
                    <h3>Tỷ lệ điểm danh</h3>
                    <i class="fas fa-chart-pie"></i>
                </div>
                <div class="metric-value">
                    {% if total_employees > 0 %}
                        {{ employees_with_checkin_today|floatformat:0 }}/{{ total_employees }}
                    {% else %}
                        0/0
                    {% endif %}
                </div>
                <div class="metric-progress">
                    <div class="progress-bar" style="width: {% if total_employees > 0 %}{% widthratio employees_with_checkin_today total_employees 100 %}{% else %}0{% endif %}%"></div>
                </div>
                <div class="metric-detail">
                    {% if total_employees > 0 %}
                        {% widthratio employees_with_checkin_today total_employees 100 %}% nhân viên đã check-in
                    {% else %}
                        0% nhân viên đã check-in
                    {% endif %}
                </div>
            </div>

            <div class="metric-card success">
                <div class="metric-header">
                    <h3>Nhân viên hoạt động</h3>
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="metric-value">{{ active_employees }}</div>
                <div class="metric-detail">trong tổng {{ total_employees }} nhân viên</div>
            </div>

            <div class="metric-card warning">
                <div class="metric-header">
                    <h3>Check-in hôm nay</h3>
                    <i class="fas fa-clock"></i>
                </div>
                <div class="metric-value">{{ today_checkins }}</div>
                <div class="metric-detail">lần check-in</div>
            </div>

            <div class="metric-card info">
                <div class="metric-header">
                    <h3>Phòng ban</h3>
                    <i class="fas fa-building"></i>
                </div>
                <div class="metric-value">{{ department_stats|length }}</div>
                <div class="metric-detail">phòng ban hoạt động</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="actions-section">
        <h2 class="section-title">Thao tác nhanh</h2>
        <div class="actions-grid">
            <a href="{% url 'employee:create' %}" class="action-card primary">
                <div class="action-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="action-content">
                    <h3>Thêm nhân viên</h3>
                    <p>Tạo tài khoản nhân viên mới</p>
                </div>
            </a>
            
            <a href="{% url 'employee:list' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="action-content">
                    <h3>Quản lý nhân viên</h3>
                    <p>Xem và chỉnh sửa thông tin</p>
                </div>
            </a>
            
            <a href="{% url 'checkin:list' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-list"></i>
                </div>
                <div class="action-content">
                    <h3>Danh sách check-in</h3>
                    <p>Xem tất cả check-in</p>
                </div>
            </a>
            
            <a href="{% url 'users:department_list' %}" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="action-content">
                    <h3>Quản lý phòng ban</h3>
                    <p>Xem và quản lý phòng ban</p>
                </div>
            </a>
        </div>
    </div>

    <!-- Department Overview -->
    <div class="department-section">
        <h2 class="section-title">Theo phòng ban</h2>
        <div class="department-grid">
            {% for dept in department_stats|slice:":6" %}
            <div class="department-card">
                <div class="department-header">
                    <h3>{{ dept.name|truncatechars:25 }}</h3>
                    <span class="employee-count">{{ dept.employee_count }} nhân viên</span>
                </div>
                <div class="department-metrics">
                    <div class="dept-metric">
                        <span class="dept-value">0</span>
                        <span class="dept-label">Check-in hôm nay</span>
                    </div>
                    <div class="dept-metric">
                        <span class="dept-value">85%</span>
                        <span class="dept-label">Tỷ lệ điểm danh</span>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <i class="fas fa-building"></i>
                <p>Chưa có phòng ban nào</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="activity-section">
        <h2 class="section-title">Hoạt động gần đây</h2>
        <div class="activity-list">
            {% for checkin in recent_checkins|slice:":5" %}
            <div class="activity-item">
                <div class="activity-avatar">
                    {% if checkin.user.avatar %}
                        <img src="{{ checkin.user.avatar.url }}" alt="{{ checkin.user.get_full_name }}">
                    {% else %}
                        <div class="avatar-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="activity-content">
                    <h4>{{ checkin.user.get_full_name }}</h4>
                    <p>{{ checkin.get_location_name|default:"Không xác định" }}</p>
                    <span class="activity-time">{{ checkin.created_at|date:"H:i" }}</span>
                </div>
                <div class="activity-status">
                    <span class="status-badge {{ checkin.get_checkin_type_display|lower }}">{{ checkin.get_checkin_type_display }}</span>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <i class="fas fa-clock"></i>
                <p>Chưa có hoạt động nào</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto refresh every 5 minutes
setInterval(function() {
    location.reload();
}, 300000);
</script>
{% endblock %}